clc;clear;
x1 = [0, 0, 1]';
x1p = [0.037, 0.086, 1]';
x2 = [1, 0, 1]';
x2p = [0.49, -0.107, 1]';
x3 = [1, 1, 1]';
x3p = [0.291, 0.401, 1]';
x4 = [0, 1, 1]';
x4p = [-0.054, 0.548, 1]';
x5 = [0.5, 0.5, 1]';
x5p = [0.238, 0.174, 1]';
x6 = [2, 1, 1]';
x6p = [0.951, -0.959, 1]';
A1 = [0, 0, 0, 0, 0, -1, 0, 0, 0.086;
     0, 0, 1, 0, 0, 0, 0, 0, -0.037;
     0, 0, 0, -1, 0, -1, -0.107, 0, -0.107;
     1, 0, 1, 0, 0, 0, -0.49, 0, -0.49;
     0, 0, 0, -1, -1, -1, 0.401, 0.401, 0.401;
     1, 1, 1, 0, 0, 0, -0.291, -0.291, -0.291;
     0, 0, 0, 0, -1, -1, 0, 0.548, 0.548;
     0, 1, 1, 0, 0, 0, 0, 0.054, 0.054];
[U1, D1, V1] = svd(A1);
h1 = V1(:,9);
% disp(h1);
h1 = h1';
H1 = [h1(1:3);h1(4:6);h1(7:9)];
disp(H1)

A2 = [0, 0, 0, -1, -1, -1, 0.401, 0.401, 0.401;
     1, 1, 1, 0, 0, 0, -0.291, -0.291, -0.291;
     0, 0, 0, 0, -1, -1, 0, 0.548, 0.548;
     0, 1, 1, 0, 0, 0, 0, 0.054, 0.054;
     0, 0, 0, -0.5, -0.5, -1, 0.087, 0.087, 0.174;
     0.5, 0.5, 1, 0, 0, 0, -0.119, -0.119, -0.238;
     0, 0, 0, -2, -1, -1, -1.918, -0.959, -0.959;
     2, 1, 1, 0, 0, 0, -1.902, -0.951, -0.951];
[U2, D2, V2] = svd(A2);
h2 = V2(:,9);
% disp(h2);
h2 = h2';
H2 = [h2(1:3);h2(4:6);h2(7:9)];
disp(H2)

X_total = [x1 x2 x3 x4 x5 x6];
Xp_total = [x1p x2p x3p x4p x5p x6p];

Xp_total_hat1 = H1*X_total;
e1 = [];
for i=1:length(X_total)
    Xp_total_hat1(:,i) = [Xp_total_hat1(1,i)/Xp_total_hat1(3,i);
                          Xp_total_hat1(2,i)/Xp_total_hat1(3,i);
                          1];
    e1 = [e1 sqrt((Xp_total_hat1(1,i) - Xp_total(1,i))^2 + (Xp_total_hat1(2,i) - Xp_total(2,i))^2)];
end
disp(Xp_total_hat1);
disp(e1)

Xp_hat2 = H2*X_total;
e2 = [];
for i=1:length(X_total)
    Xp_hat2(:,i) = [Xp_hat2(1,i)/Xp_hat2(3,i);
                   Xp_hat2(2,i)/Xp_hat2(3,i);
                   1];
    e2 = [e2 sqrt((Xp_hat2(1,i) - Xp_total(1,i))^2 + (Xp_hat2(2,i) - Xp_total(2,i))^2)];
end
% disp(Xp_hat2);
disp(e2);


% H2 = [6.93889390390723e-17	-0.161422165513543	0.161422165513543;
% -3.53154919382100e-16	-0.118014524367043	0.118014524367043;
% -3.73265388005523e-16	-0.678244392914043	0.678244392914044];

% A = [0, 0, 0, 0, 0, -1, 0, 0, 0.086;
%      0, 0, 1, 0, 0, 0, 0, 0, -0.037;
%      0, 0, 0, -1, 0, -1, -0.107, 0, -0.107;
%      1, 0, 1, 0, 0, 0, -0.49, 0, -0.49;
%      0, 0, 0, -1, -1, -1, 0.401, 0.401, 0.401;
%      1, 1, 1, 0, 0, 0, -0.291, -0.291, -0.291;
%      0, 0, 0, 0, -1, -1, 0, 0.548, 0.548;
%      0, 1, 1, 0, 0, 0, 0, 0.054, 0.054;
%      0, 0, 0, -0.5, -0.5, -1, 0.087, 0.087, 0.174;
%      0.5, 0.5, 1, 0, 0, 0, -0.119, -0.119, -0.238];
% [U, D, V] = svd(A);
% % disp(V);
% h = V(:,9);
% % disp(h);
% loss = norm(A*h);
% disp(loss);

% H = [0.3030, -0.1164, 0.0598;
%      -0.1552, 0.3828, 0.0627;
%      -0.0820, -0.0141, 0.8424];
% H_hat = [0.455800, -0.137164, 0.064297;
%          -0.187786, 0.577227, 0.065843;
%          0.025337, 0.135953, 1.045104];

% 
% X = [x1 x2 x3 x4 x5];
% Xp = [x1p x2p x3p x4p x5p];
% Xp_hat = H_hat*X;
% e = 0;
% for i=1:length(X)
%     Xp_hat(:,i) = [Xp_hat(1,i)/Xp_hat(3,i);
%                    Xp_hat(2,i)/Xp_hat(3,i);
%                    1];
%     e = e  + ((Xp_hat(1,i) - Xp(1,i))^2 + (Xp_hat(2,i) - Xp(2,i))^2);
% end
% disp(Xp_hat);
% disp(e)
